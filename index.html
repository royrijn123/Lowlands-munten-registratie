<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Lowlands Scan</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      text-align: center;
    }
    .btn {
      width: 100%;
      height: 33.33vh;
      font-size: 5em;
      border: none;
      color: white;
      cursor: pointer;
    }
    .btn-1 { background-color: #3498db; }
    .btn-15 { background-color: #f1c40f; }
    .btn-2 { background-color: #e74c3c; }
  </style>
</head>
<body>
  <button class="btn btn-1" onclick="sendAmount(1)">1 munt</button>
  <button class="btn btn-15" onclick="sendAmount(1.5)">1,5 munt</button>
  <button class="btn btn-2" onclick="sendAmount(2)">2 munten</button>

  <script>
    const apiUrl = "https://script.google.com/macros/s/AKfycbwE6EBlHX9Y6BYJSeUBRJNuENMssdpy2MBta3j540nqns8jbgNuQKVcd_aau0Z9OkWZsA/exec";
    const chipId = new URLSearchParams(window.location.search).get("chipId");

    if (!chipId) {
      alert("Geen chipId gevonden in de URL");
      throw new Error("Geen chipId");
    }

    let chipOwner = "";
    let scannerName = localStorage.getItem("scannerName");

    async function init() {
      // Ophalen eigenaar
      let res = await fetch(`${apiUrl}?action=getOwner&chipId=${chipId}`);
      let owner = await res.text();
      if (owner) {
        chipOwner = owner;
      } else {
        chipOwner = prompt("Van wie is deze chip?");
        await fetch(apiUrl, {
          method: "POST",
          body: new URLSearchParams({ action: "setOwner", chipId, owner: chipOwner })
        });
      }

      // Scannernaam opslaan als nog niet bekend
      if (!scannerName) {
        scannerName = prompt(`Je scande de chip van ${chipOwner}. Wat is jouw naam?`);
        localStorage.setItem("scannerName", scannerName);
      }
    }

    async function sendAmount(amount) {
      document.querySelectorAll(".btn").forEach(btn => btn.disabled = true);

      let res = await fetch(apiUrl, {
        method: "POST",
        body: new URLSearchParams({
          action: "scan",
          chipId,
          owner: chipOwner,
          scanner: scannerName,
          amount
        })
      });
      let text = await res.text();
      alert(`Gelukt! Je hebt ${amount} munt(en) gegeven aan ${text}`);
    }

    init();
  </script>
</body>
</html>
