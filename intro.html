<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>LLET'S SPLIT – Intro</title>

<script src="https://cdn.tailwindcss.com"></script>

<style>
  @font-face {
    font-family: 'Baukasten';
    src: url('fonts/Baukasten Six Regular.otf') format('opentype');
  }

  body {
    background: #A54EFF;
    color: #FFF685;
    font-family: 'Baukasten', sans-serif;
    text-transform: uppercase;
    letter-spacing: 1px;
    padding: 32px 24px;
  }

  .btn {
    background: #FFF685;
    color: #A54EFF;
    padding: 16px;
    width: 100%;
    border-radius: 14px;
    text-align: center;
    font-size: 1.3rem;
    margin-top: 30px;
  }

  .btn:active {
    transform: scale(0.97);
  }
</style>
</head>
<body>

<div class="text-center text-4xl mb-10">LLET'S SPLIT</div>

<div id="info" class="text-center text-lg leading-7 mb-10">
  MET LLET'S SPLIT HOUD JE BIJ<br>
  WIE WELK RONDJE HAALT.<br><br>
  JE HEBT HIERVOOR DE NFC-STICKER<br>
  NODIG DIE JE BIJ DE INGANG HEBT GEKREGEN.
</div>

<button id="scanBtn" class="btn">
  NFC-STICKER SCANNEN
</button>

<script>
  const params = new URLSearchParams(window.location.search);
  const chipId = params.get("chipId");
  const savedName = localStorage.getItem("scannerName");

  // 1. Als er al een chipId in de URL zit → direct door naar integratie
  if (chipId) {
    // Als naam al bekend is of niet: in beide gevallen gewoon naar integratie
    window.location.href = `lowlandsintegratie.html?chipId=${encodeURIComponent(chipId)}`;
  }

  const infoEl = document.getElementById("info");
  const scanBtn = document.getElementById("scanBtn");

  scanBtn.onclick = async () => {
    // ANDROID: WebNFC beschikbaar
    if ("NDEFReader" in window) {
      try {
        const reader = new NDEFReader();
        await reader.scan();

        infoEl.innerHTML = `
          HOUD JE NFC-STICKER<br>
          TEGEN DE BOVENKANT VAN JE TELEFOON.
        `;

        reader.onreading = event => {
          const serial = event.serialNumber || "";
          // Als je op Android de UID wilt gebruiken als chipId:
          if (serial) {
            window.location.href =
              `lowlandsintegratie.html?chipId=${encodeURIComponent(serial)}`;
          } else {
            infoEl.innerHTML = `
              KON GEEN CHIP LEZEN.<br><br>
              PROBEER HET NOG EEN KEER<br>
              OF SCAN DE QR-CODE OP JE STICKER.
            `;
          }
        };
      } catch (e) {
        console.error(e);
        infoEl.innerHTML = `
          SCANNEN IS MISLUKT.<br><br>
          PROBEER HET OPNIEUW<br>
          OF SCAN DE QR-CODE OP JE STICKER.
        `;
      }
    } else {
      // iOS (ook iPhone 7/8/X): geen WebNFC → duidelijk uitleg, GEEN foutpop-up
      infoEl.innerHTML = `
        HOUD JE NFC-STICKER<br>
        TEGEN DE BOVENKANT VAN JE TELEFOON.<br><br>
        WERKT HET NIET DIRECT?<br>
        OPEN DAN DE CAMERA EN SCAN DE QR-CODE<br>
        OP JE STICKER OM VERDER TE GAAN.
      `;
    }
  };
</script>

</body>
</html>
